\documentclass[main.tex]{subfiles}

\begin{document}

\section{Offer Network Specifciation}
An \textbf{offer network} instance can be formally modeled as a directed graph, $G$, where vertices $t \in T$ represent tasks, $u \in U$ users, and labeled directed edges $(t_a,t_b) : u_1$\footnote{Can be a hypergraph if one wants user nodes rather than labels.}\footnote{In the current implementation, actually a multigraph: there can be multiple edges ($t_a,t_b$).} represent an offer by user $u_1$ to do task $t_a$ in exchange requested task $t_b$. I will call edgesCall this the task-centric graph formulation.
\begin{center}
  \begin{tikzpicture}
    \node[draw, circle] (ta) at (0,0) {$t_a$};
    \node[draw, circle] (tb) at (6,0) {$t_b$};
    \path [->] (ta) edge node[above] {$u_1$} (tb);
  \end{tikzpicture}
\end{center}

A matching of users who can satisfy each other is a vertex cycle. See the simplest case below:

\begin{center}
  \begin{tikzpicture}
    \node[draw, circle] (ta) at (0,0) {$t_a$};
    \node[draw, circle] (tb) at (6,0) {$t_b$};
    \draw[-latex] (ta) to[bend left=10] node[above] {$u_1$} (tb);
    \draw[-latex] (tb) to[bend left=10] node[below] {$u_2$ }(ta);
  \end{tikzpicture}
\end{center}

\subsection{Dynamic Offer Network Specification}
The dynamic offer network is modeled in terms of discrete timesteps: $s = 0, 1, 2 \dots$.
Let $N_t, N_d, N_m \in \mathbb{N}$, $p \in [0,1]$ be constants.

Between each timestep the following events can take place:
\begin{itemize}
  \item Add $N_t$ new edges to the graph
  \item Remove $N_d$ unsatisfied edges
\end{itemize}

In addition every $N_m$ steps, an optimization algorithm is run in batch to suggest exchanges to users. An exchange is accepted if each edge is accepted by its user. Users accept the exchange for an edge with probability $p$. Rejected exchanges are left as is. All edges in accepted exchanges are removed from the graph.

\subsubsection{Cycle Size and Acceptance Probability}

In a cycle $c$ of size $k$, the probability of acceptance is $p_k = p^k$.

Thus the expected number of satisfied users is: $\E[c_k] = k p^k$. For a given $p$, the best cycle size is given by $k = -\frac{1}{\ln p}$, and the best attainable for $p$ is $-\frac{1}{e \ln p}$.

\begin{figure}
  \includegraphics[scale=0.65]{best-k.png}
  \caption{Best k-cycle for p from 0.8 to 1}
  \label{best-k}
\end{figure}

\begin{figure}
  \includegraphics[width=\textwidth]{eckp1.png}
  \caption{$\E[c_k]$ for $k = 2 \dots 10$}
  \label{eckp1}
\end{figure}

\begin{figure}
  \includegraphics[width=\textwidth]{eckp2.png}
  \caption{$\E[c_k]$ for $k = 2 \dots 50$}
  \label{eckp2}
\end{figure}

As can be seen in \ref{best-k}, the optimal cycle size exponentially incresaes for $p > 0.95$ ($k \approx 19.5$), so the maximum without cycle-length constraints will likely suffice. And in \ref{eckp1} one sees that $2$-cycles are optimal $p < 0.7$. The Polynomial time solution is less clear for the following cases:
\begin{itemize}
  \item $0.7 < p < 0.85$ where $ 2 < k < 10$ is optimal.
  \item $0.85 < p < 0.95$ where $ 10 < k < 30$ is optimal,
      \\yet the larger cycles are little bitter than shorter ones.
\end{itemize}

For human users without very specific task formulations, $p$ likely lies in this range.

\subsubsection{How many matches are needed to for acceptance?}
Assuming the hanging offers and requests approach is used, how many times should a user expect to wait for a given $p$?

In a given round, the probability the suggested match goes through is $p^3$ as both neighbors in a cycle also need to accept. Thus the expected number of rounds for acceptance follows the geometric distribution: $\sum_{k=0}^{\infty} k P^3 (1 - p^3)^{k-1} = \frac{1}{p^3}$.

\begin{figure}
  \includegraphics[width=\textwidth]{nrounds.png}
  \caption{(a)-(c) plot expected number of rounds for acceptance of an ORpair for different $p$. (a) is for 2-cyles. (b) and (c) k-cycle. (d)-(e) plot the probability of an ORpair not being accepted in 2 rounds. (d) is k-cycle and (e) is 2-cycle.}
  \label{nrounds}
\end{figure}

As one can see in \ref{fig:nrounds}, one expects 5 rounds to be needed by $p = 0.6$. Fortunately, for $p > 0.7$, one expcets less than 3 rounds to be needed. With 2-cycles, one only needs 3 or 4 rounds for $p = 0.6$ or $0.5$. For lower $p$, the offer network will likely be too frustrating for human users: matching will have to be done on more detailed task specifications \footnote{Acceptance probaility is likely proportional to how detailed task specifications are; however, there are also limits as to how detailed humans can be.}.

One can also easily calculate the probability acceptance for an ORpair will take more than two rounds: $1 - (p^3 + p^3 * (1 - p^3))$.

\subsection{Additional Features}

The graph model can be made more sophisticated by drawing $N_tt$ and $N_d$ from a distribution, probabilistically adding new tasks, etc. $p$ could also be drawn from a distribution on a user or edge basis. The parameters can also be made super-constants dependent on the graph size.

Below is a list of potentially desirable features of an offer network that don't qualify for an MVP:
\begin{itemize}
  \item Reputation biased matching
  \item Preferences for matching based on
    \begin{itemize}
      \item User preferences
      \item Task prefreences
    \end{itemize}
  \item ORs and ANDs of offers or request
\end{itemize}


\end{document}
